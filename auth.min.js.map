{"version":3,"sources":["static/auth.js"],"names":["firebase","firebaseui","lock","userData","currentUid","currentIdToken ","ui","auth","AuthUI","onAuthStateChanged","user","uid","document","getElementById","style","display","handleSignedInUser","handleSignedOutUser","sendUserInfo","userIdToken","xmlhttp","XMLHttpRequest","open","setRequestHeader","onreadystatechange","readyState","send","JSON","stringify","getToken","then","idToken","currentIdToken","body","className","replace","s","getAttribute","window","uiConfig","eval","textContent","start","addEventListener","event","forEach","call","getElementsByClassName","el","onclick","callback","errorCallback","signOut","error"],"mappings":"AAAwB,mBAAbA,WAAkD,mBAAfC,cACzC,SAAUD,SAAUC,YACjBD,SAASE,MAAO,EAChBF,SAASG,UACLC,WAAc,GACdC,kBAAmB,GAEvB,IAAIC,IAAK,GAAIL,YAAWM,KAAKC,OAAOR,SAASO,OAC7CP,UAASO,OAAOE,mBAAmB,SAAUC,GACrCA,GAAQA,EAAKC,KAAOX,SAASG,SAASC,aAC1CQ,SAASC,eAAe,yBAAyBC,MAAMC,QAAU,OACjEH,SAASC,eAAe,wBAAwBC,MAAMC,QAAU,QAChEL,EAAOM,mBAAmBN,GAAQO,yBAGtCjB,SAASkB,aAAe,SAAUR,EAAMS,GACpC,IAAInB,SAASE,KAAb,CACA,GAAIkB,GAAU,GAAIC,eAClBD,GAAQE,KAAK,OAAQ,oCACrBF,EAAQG,iBAAiB,eAAgB,kCACzCH,EAAQG,iBAAiB,gBAAiB,UAAYJ,GACtDC,EAAQI,mBAAqB,WAAuC,GAAtBJ,EAAQK,aAAiBzB,SAASE,MAAO,IACvFF,SAASE,MAAO,EAChBkB,EAAQM,KAAKC,KAAKC,UAAUlB,KAGhC,IAAIM,oBAAqB,SAAUN,GAC/BA,EAAKmB,WAAWC,KAAK,SAAUC,GAC3B/B,SAASG,SAAS6B,eAAiBD,EACnCnB,SAASqB,KAAKC,UAAYtB,SAASqB,KAAKC,UAAUC,QAAQ,mBAAoB,IAAIA,QAAQ,kBAAmB,IAAIA,QAAQ,iBAAkB,IAC3IvB,SAASqB,KAAKC,WAAa,gCAAiClC,SAASkB,aAAaR,EAAMqB,EACxF,IAAIK,GAAIxB,SAASC,eAAe,mBAAmBwB,aAAa,0BAChE,OAAyB,kBAAdC,QAAOF,IACPE,OAAOF,GAAG1B,MAOzBO,oBAAsB,WACtBL,SAASqB,KAAKC,UAAYtB,SAASqB,KAAKC,UAAUC,QAAQ,mBAAoB,IAAIA,QAAQ,kBAAmB,IAAIA,QAAQ,iBAAkB,IAC3IvB,SAASqB,KAAKC,WAAa,gCAC3B,IAAIK,YACJC,MAAK,cAAgB5B,SAASC,eAAe,mBAAmB4B,aAChEnC,GAAGoC,MAAM,6BAA8BH,SACvC,IAAIH,GAAIxB,SAASC,eAAe,mBAAmBwB,aAAa,2BACvC,mBAAdC,QAAOF,IACdE,OAAOF,KAGfxB,UAAS+B,iBAAiB,mBAAoB,SAASC,MAChDC,QAAQC,KAAKlC,SAASmC,uBAAuB,wBAAyB,SAAUC,GAC/EA,EAAGC,QAAU,SAAUC,EAAUC,GAC7BnD,SAASO,OAAO6C,UAAUtB,KAAK,WAC3B9B,SAASkB,eACe,kBAAbgC,IACPA,EAASG,QAEd,SAASA,GACqB,kBAAlBF,IACPA,EAAcE,WAMpCrD,SAAUC","file":"auth.min.js","sourcesContent":["if (typeof firebase !== \"undefined\" && typeof firebaseui !== \"undefined\"){\r\n    (function (firebase, firebaseui) {\r\n        firebase.lock = false;\r\n        firebase.userData = {\r\n            \"currentUid\": \"\",\r\n            \"currentIdToken \": \"\"\r\n        };\r\n        var ui = new firebaseui.auth.AuthUI(firebase.auth());\r\n        firebase.auth().onAuthStateChanged(function (user) {\r\n            if (user && user.uid == firebase.userData.currentUid) return;\r\n            document.getElementById('firebase_auth_loading').style.display = 'none';\r\n            document.getElementById('firebase_auth_loaded').style.display = 'block';\r\n            user ? handleSignedInUser(user) : handleSignedOutUser();\r\n        });\r\n\r\n        firebase.sendUserInfo = function (user, userIdToken){\r\n            if (firebase.lock) return;\r\n            var xmlhttp = new XMLHttpRequest();   // new HttpRequest instance\r\n            xmlhttp.open(\"POST\", \"/firebase_authentication/sign_in\");\r\n            xmlhttp.setRequestHeader(\"Content-Type\", \"application/json;charset=UTF-8\");\r\n            xmlhttp.setRequestHeader(\"Authorization\", 'Bearer ' + userIdToken);\r\n            xmlhttp.onreadystatechange = function() { if (xmlhttp.readyState == 4) firebase.lock = false; };\r\n            firebase.lock = true;\r\n            xmlhttp.send(JSON.stringify(user));\r\n        };\r\n\r\n        var handleSignedInUser = function (user) {\r\n            user.getToken().then(function (idToken) {\r\n                firebase.userData.currentIdToken = idToken;\r\n                document.body.className = document.body.className.replace(\" auth_signed_out\", \"\").replace(\" auth_signed_in\", \"\").replace(\" firebase_auth\", \"\");\r\n                document.body.className += \" firebase_auth auth_signed_in\"; firebase.sendUserInfo(user, idToken);\r\n                var s = document.getElementById('firebase_config').getAttribute('data-callback-signed-in');\r\n                if (typeof window[s] === \"function\") {\r\n                    return window[s](user);\r\n                } else {\r\n                    return false;\r\n                }\r\n            });\r\n        };\r\n\r\n        var handleSignedOutUser = function () {\r\n            document.body.className = document.body.className.replace(\" auth_signed_out\", \"\").replace(\" auth_signed_in\", \"\").replace(\" firebase_auth\", \"\");\r\n            document.body.className += \" firebase_auth auth_signed_out\";\r\n            var uiConfig = {};\r\n            eval(\"uiConfig = \" + document.getElementById('firebase_config').textContent);\r\n            ui.start('#firebaseui-auth-container', uiConfig);\r\n            var s = document.getElementById('firebase_config').getAttribute('data-callback-signed-out');\r\n            if (typeof window[s] === \"function\") {\r\n                window[s]();\r\n            }\r\n        };\r\n        document.addEventListener(\"DOMContentLoaded\", function(event) {\r\n            [].forEach.call(document.getElementsByClassName(\"btn_firebase_signout\"), function (el) {\r\n                el.onclick = function (callback, errorCallback){\r\n                    firebase.auth().signOut().then(function() {\r\n                        firebase.sendUserInfo();\r\n                        if (typeof callback === \"function\"){\r\n                            callback(error);\r\n                        }\r\n                    }, function(error) {\r\n                        if (typeof errorCallback === \"function\"){\r\n                            errorCallback(error);\r\n                        }\r\n                    });\r\n                };\r\n            });\r\n        });\r\n    }(firebase, firebaseui));\r\n}\r\n"]}